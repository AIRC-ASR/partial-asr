import json
import os
import re

pattern = r'<hypothesis1>(.*?)</hypothesis3>'
instruction = "Perform error correction on the top 3 outputs generated by an Automatic Speech Recognition (ASR) system for the provided partial audio segment. The audio was removed from the end of the snippet for this task. The ASR hypotheses, listed in order of their ASR posterior score, are as follows:"
ending = "Please provide the corrected top1 ASR transcription of the given utterance only, do not add any explanations or other words."
new_data = []
file_prefix = "25-percent-removed/dev-clean"
with open(f"{file_prefix}.jsonl", "r") as f:
  for line in f:
    data = json.loads(line)
    output = data["output"]
    matches = re.findall(pattern, data['text'], re.DOTALL)
    print(data)
    print("matches", "<hypothesis1>" + matches[0] + "</hypothesis3>")
    data_point = {
      "instruction": instruction + "\n",
      "input": "<hypothesis1>" + matches[0] + "</hypothesis3>\n" + ending + "\n",
      "output": output
    }
    new_data.append(data_point)

with open(f"{file_prefix}.json", "w") as f:
  json.dump(new_data, f, indent=2)
os.remove(f"{file_prefix}.jsonl")
